---
layout:        post
title:         "线段树"
subtitle:      "Segment Tree"
author:        "hongzhiyin"
header-style:  text
mathjax:       true
catalog:       true
tags:
  - 虚空万藏
  - 线段树

---


## 相关概念

一棵二叉树，每个节点对应一个区间，维护与区间相关的信息。

分为两类信息：

1. 待查询信息
2. 延迟标记信息

**待查询信息**

如：区间和，区间最值，区间异或和，区间 $GCD$ 等，需满足区间可加性。

**延迟标记信息**

涉及区间更新时，需要用到延迟标记，以保证复杂度。

本质为，暂存下对于某个区间的多次更新的操作，

当需要查询该区间的子区间时，能够对子区间一次性完成所有更新。



## 解题过程

1. 前提：区间查询的结果满足区间可加性。

2. 列出关于区间修改的表达式

   1. 列出关于单点修改的表达式
      $$
      x_i = F(x_i)
      $$

   2. 列出关于区间修改的表达式
      $$
      sum(l, r) = F(\ sum(l, r)\ )
      $$

   3. 列出重复在同一区间上修改 $k$ 次的表达式
      $$
      sum(l, r) = F(\ sum(l, r),\ k\ )
      $$

   4. 包含有 $k$ 的部分即为延迟标记需要维护的部分
      $$
      sum(l, r) = F(\ lazy(k),\ sum(l, r)\ )
      $$
   
3. $build(1, n, 1)$ 中初始化 “待查询信息” 与 “延迟标记信息”

4. 区间更新 $upd(l, r, val, 1, n, 1)$ 

   1. $Add(rt, val)$ 可看作一次 $pushdown$ ，将更新内容作用到对应节点，

      更新结点所维护的 待查询信息 和 延迟标记 。

5. 区间查询 $qry(l, r, 1, n, 1)$ 



## 例题



